<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Submit College Application Info</title>
</head>
<body>
  <h1>Submit College Application Info</h1>

  <form id="collegeForm">
    <!-- College -->
    <div>
      <label for="college">College:</label><br />
      <input type="text" id="college" name="college" required>
    </div>

    <!-- Essay -->
    <div style="margin-top: 10px;">
      <label for="essay">Essay:</label><br />
      <textarea id="essay" name="essay" rows="6" cols="40" required></textarea>
    </div>

    <!-- Major -->
    <div style="margin-top: 10px;">
      <label for="major">Major:</label><br />
      <input type="text" id="major" name="major" required>
    </div>

    <!-- GPA -->
    <div style="margin-top: 10px;">
      <label for="gpa">GPA:</label><br />
      <input type="number" step="0.01" id="gpa" name="gpa" required>
    </div>

    <!-- Status -->
    <div style="margin-top: 10px;">
      <label for="status">Status:</label><br />
      <select id="status" name="status" required>
        <option value="">Select status</option>
        <option value="admitted">Admitted</option>
        <option value="waitlisted">Waitlisted</option>
        <option value="rejected">Rejected</option>
      </select>
    </div>

    <!-- Admission Year -->
    <div style="margin-top: 10px;">
      <label for="admissionYear">Admission Year:</label><br />
      <input type="number" id="admissionYear" name="admissionYear" required>
    </div>

    <!-- Classes -->
    <div style="margin-top: 10px;">
      <label for="classes">Classes (list classes separated by commas):</label><br />
      <textarea id="classes" name="classes" rows="4" cols="40" required></textarea>
    </div>

    <!-- Additional Info -->
    <div style="margin-top: 10px;">
      <label for="additionalInfo">Additional Info:</label><br />
      <textarea id="additionalInfo" name="additionalInfo" rows="4" cols="40"></textarea>
    </div>

    <!-- Submit button -->
    <div style="margin-top: 20px;">
      <button type="submit">Submit</button>
    </div>
  </form>

  <!-- Result display -->
  <div id="result" style="margin-top: 20px; color: green;"></div>

  <script>
    const form = document.getElementById('collegeForm');
    const resultDiv = document.getElementById('result');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Gather form data
      const formData = {
        college: form.college.value,
        essay: form.essay.value,
        major: form.major.value,
        gpa: parseFloat(form.gpa.value),
        status: form.status.value,
        admissionYear: parseInt(form.admissionYear.value), // Correct field for admission year
        classes: form.classes.value.split(',').map(c => c.trim()), // split classes into an array
        additionalInfo: form.additionalInfo.value
      };

      try {
        const response = await fetch('http://localhost:3001/submit-stats', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          credentials: 'include',
          body: JSON.stringify(formData)
        });

        const data = await response.json();

        if (response.ok) {
          resultDiv.style.color = 'green';
          resultDiv.innerText = 'Submission successful!';
          console.log('Submitted data:', data);
        } else {
          resultDiv.style.color = 'red';
          resultDiv.innerText = `Error: ${data.message}`;
        }
      } catch (error) {
        console.error('Error submitting form:', error);
        resultDiv.style.color = 'red';
        resultDiv.innerText = 'Server error. Try again later.';
      }
    });
  </script>
</body>
</html>
